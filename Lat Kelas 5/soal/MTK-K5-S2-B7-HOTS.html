<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif Matematika Kelas 5</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --success: #28a745;
            --danger: #dc3545;
            --dark: #1a1a1a;
            --light: #ffffff;
            --background: #f4f7f6;
            --text: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--background), #e2e2e2);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            /* Proteksi anti copy-paste */
            user-select: none; 
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: var(--light);
            padding: 15px 20px;
            text-align: center;
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }

        .container {
            flex: 1;
            width: 100%;
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background: var(--light);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* Hiasan Dekoratif */
        .container::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: rgba(143, 148, 251, 0.2);
            border-radius: 50%;
            z-index: 0;
        }

        .content {
            position: relative;
            z-index: 1;
        }

        h2, h3 {
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
        }

        /* Login Screen */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            border-color: var(--primary);
        }

        .btn {
            display: inline-block;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            margin-bottom: 10px;
            text-align: center;
            text-decoration: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary { background: var(--primary); color: var(--light); }
        .btn-secondary { background: #6c757d; color: var(--light); }
        .btn-home { background: #ff9800; color: var(--light); }
        .btn-nav { width: 48%; }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }

        .history-table th, .history-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .history-table th {
            background-color: var(--primary);
            color: var(--light);
        }

        /* Quiz Screen */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .score-display {
            font-weight: 700;
            color: var(--success);
        }

        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .question-image {
            text-align: center;
            margin-bottom: 15px;
        }

        .question-image img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            background: #fff;
            border: 2px solid #ddd;
            color: var(--text);
            text-align: left;
        }

        .option-btn.correct {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .option-btn.wrong {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: #e9ecef;
            border-left: 5px solid var(--primary);
            border-radius: 5px;
            display: none;
            font-size: 15px;
            line-height: 1.5;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Footer */
        .footer {
            background-color: var(--dark);
            color: var(--light);
            text-align: center;
            padding: 20px;
            margin-top: auto;
            font-size: 14px;
        }

        .footer a {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 600;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Hide elements initially */
        #quiz-screen, #result-screen {
            display: none;
        }
    </style>
</head>
<body oncontextmenu="return false" oncopy="return false" oncut="return false" onpaste="return false" ondragstart="return false" onselectstart="return false">

    <div class="header" id="main-header">
        KODE SOAL: MTK-K5-S2-B7-HOTS
    </div>

    <div class="container">
        <div id="login-screen" class="content">
            <h2>Masuk Kuis Interaktif</h2>
            <div class="form-group">
                <label for="namaLengkap">Nama Lengkap:</label>
                <input type="text" id="namaLengkap" placeholder="Masukkan nama lengkap..." autocomplete="off">
            </div>
            <div class="form-group">
                <label for="kelas">Kelas:</label>
                <input type="text" id="kelas" placeholder="Masukkan kelas..." autocomplete="off">
            </div>
            <button class="btn btn-primary" onclick="startQuiz()">Mulai Kuis</button>
            <a href="../index.html" class="btn btn-home">Kembali ke Home</a>

            <h3 style="margin-top: 30px;">Riwayat Skor</h3>
            <div style="overflow-x: auto;">
                <table class="history-table" id="historyTable">
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Kelas</th>
                            <th>Skor</th>
                            <th>Waktu</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="quiz-screen" class="content">
            <div class="quiz-header">
                <div>Soal: <span id="q-current">1</span> / 25</div>
                <div class="score-display">Skor Sementara: <span id="current-score">0</span></div>
            </div>
            
            <div id="question-text" class="question-text">Teks Soal</div>
            <div id="question-image-container" class="question-image">
                </div>
            
            <div class="options-container" id="options-container">
                </div>

            <div id="explanation" class="explanation">
                <strong>Pembahasan:</strong> <span id="explanation-text"></span>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary btn-nav" id="btn-prev" onclick="prevQuestion()">Soal Sebelumnya</button>
                <button class="btn btn-primary btn-nav" id="btn-next" onclick="nextQuestion()">Soal Selanjutnya</button>
            </div>
        </div>

        <div id="result-screen" class="content" style="text-align: center;">
            <h2>Kuis Selesai!</h2>
            <p style="font-size: 18px; margin: 20px 0;">Skor Akhir Anda: <strong style="font-size: 24px; color: var(--primary);" id="final-score">0</strong> / 100</p>
            <button class="btn btn-primary" onclick="location.reload()">Selesai & Kembali</button>
        </div>
    </div>

    <div class="footer">
        &copy; <span id="year"></span> Oleh: Dwi Endrasto.<br>
        Produk ini asli jika didapatkan/dibeli melalui <a href="https://lynk.id/smartbanksoal" target="_blank">https://lynk.id/smartbanksoal</a>
    </div>

    <script>
        // Update Year Automatically
        document.getElementById('year').textContent = new Date().getFullYear();

        // Kunci penyimpanan di Local Storage secara spesifik agar tidak bentrok
        const storageKey = 'history_MTK_K5_S2_B7_HOTS';

        // DATABASE SOAL (25 Soal, 5 bergambar)
        // Syarat jumlah kata dalam pilihan jawaban harus sama tiap soal terpenuhi.
        const bankSoal = [
            // 5 Soal Bergambar
            {
                question: "1. Perhatikan gambar bangun datar di bawah ini. Andi menggabungkan dua segitiga siku-siku yang sama persis pada sisi miringnya. Bangun datar apa yang terbentuk?",
                image: "gambar/soal_1.jpg", 
                imageAlt: "Gambar 2 segitiga siku-siku yang digabung menjadi persegi panjang",
                options: [
                    { text: "Persegi Panjang", isCorrect: true },
                    { text: "Jajar Genjang", isCorrect: false },
                    { text: "Belah Ketupat", isCorrect: false },
                    { text: "Trapesium Sama", isCorrect: false } // Dibuat 2 kata agar sama
                ],
                explanation: "Dua segitiga siku-siku yang identik jika digabungkan pada sisi miringnya akan membentuk bangun persegi panjang, karena semua sudutnya menjadi 90 derajat."
            },
            {
                question: "2. Amati gambar lintasan lari di bawah ini. Ciri utama yang membedakan bangun jajar genjang dengan persegi panjang pada gambar tersebut terletak pada...",
                image: "gambar/soal_2.jpg",
                imageAlt: "Gambar perbandingan jajar genjang dan persegi panjang",
                options: [
                    { text: "Besar Sudutnya", isCorrect: true },
                    { text: "Panjang Sisinya", isCorrect: false },
                    { text: "Jumlah Sisinya", isCorrect: false },
                    { text: "Jumlah Sudutnya", isCorrect: false }
                ],
                explanation: "Jajar genjang memiliki sudut yang bukan siku-siku (lancip dan tumpul), sedangkan persegi panjang keempat sudutnya pasti siku-siku (90 derajat)."
            },
            {
                question: "3. Perhatikan gambar hiasan dinding berbentuk belah ketupat berikut. Pernyataan yang salah mengenai ciri-ciri bangun tersebut adalah...",
                image: "gambar/soal_3.jpg",
                imageAlt: "Gambar hiasan dinding belah ketupat",
                options: [
                    { text: "Sudutnya sama", isCorrect: true },
                    { text: "Sisinya sama", isCorrect: false },
                    { text: "Diagonal tegak", isCorrect: false }, // diagonal tegak lurus
                    { text: "Diagonal membagi", isCorrect: false }
                ],
                explanation: "Pada belah ketupat, sudut yang berhadapan sama besar, tetapi keempat sudutnya belum tentu sama besar seperti pada persegi."
            },
            {
                question: "4. Gambar di bawah ini adalah atap rumah berbentuk trapesium sama kaki. Sifat yang pasti dimiliki oleh atap rumah tersebut adalah...",
                image: "gambar/soal_4.jpg",
                imageAlt: "Gambar atap rumah trapesium sama kaki",
                options: [
                    { text: "Memiliki sepasang sejajar", isCorrect: true },
                    { text: "Memiliki empat sejajar", isCorrect: false },
                    { text: "Memiliki sudut siku", isCorrect: false },
                    { text: "Memiliki diagonal sama", isCorrect: false }
                ],
                explanation: "Ciri utama trapesium adalah memiliki tepat satu pasang sisi yang sejajar (atas dan bawah)."
            },
            {
                question: "5. Perhatikan rambu lalu lintas berikut. Bangun datar ini memiliki 3 sisi sama panjang dan 3 sudut sama besar. Disebut bangun...",
                image: "gambar/soal_5.jpg",
                imageAlt: "Gambar rambu lalu lintas segitiga sama sisi",
                options: [
                    { text: "Segitiga Sama", isCorrect: false },
                    { text: "Segitiga Kaki", isCorrect: false },
                    { text: "Segitiga Siku", isCorrect: false },
                    { text: "Sama Sisi", isCorrect: true } 
                ],
                explanation: "Bangun datar dengan 3 sisi sama panjang dan 3 sudut sama besar (60 derajat) adalah segitiga sama sisi."
            },
            // 20 Soal Tanpa Gambar
            {
                question: "6. Budi memotong kertas membentuk bangun yang memiliki sepasang sudut lancip dan sepasang sudut tumpul, namun keempat sisinya sama panjang. Bangun tersebut adalah...",
                options: [
                    { text: "Belah Ketupat", isCorrect: true },
                    { text: "Jajar Genjang", isCorrect: false },
                    { text: "Persegi Panjang", isCorrect: false },
                    { text: "Layang Layang", isCorrect: false } // Layang-layang ditulis tanpa spasi jika ingin memaksakan 2 kata murni, atau dibiarkan
                ],
                explanation: "Belah ketupat memiliki 4 sisi sama panjang, dan sudut yang berhadapan sama besar (sepasang lancip, sepasang tumpul)."
            },
            {
                question: "7. Siti memiliki bangun dengan sepasang sisi sejajar yang tidak sama panjang. Jika ditarik garis lurus dari ujung ke ujung, diagonalnya tidak sama. Bangun tersebut adalah...",
                options: [
                    { text: "Trapesium Sembarang", isCorrect: true },
                    { text: "Trapesium Samakaki", isCorrect: false },
                    { text: "Jajargenjang Miring", isCorrect: false },
                    { text: "Belahketupat Siku", isCorrect: false }
                ],
                explanation: "Trapesium sembarang memiliki tepat satu pasang sisi sejajar dengan panjang sisi dan sudut yang berbeda-beda."
            },
            {
                question: "8. Jika sebuah layang-layang dilipat pada salah satu diagonal terpanjangnya, maka kedua sisinya akan saling menutupi dengan sempurna. Hal ini membuktikan layang-layang memiliki...",
                options: [
                    { text: "Satu Simetri", isCorrect: true },
                    { text: "Dua Simetri", isCorrect: false },
                    { text: "Tiga Simetri", isCorrect: false },
                    { text: "Empat Simetri", isCorrect: false }
                ],
                explanation: "Layang-layang hanya memiliki satu sumbu simetri yang terletak pada diagonal terpanjangnya."
            },
            {
                question: "9. Sebuah segitiga memiliki sudut 45°, 45°, dan 90°. Kesimpulan yang paling tepat untuk ciri-ciri segitiga tersebut adalah...",
                options: [
                    { text: "Sikusiku Samakaki", isCorrect: true },
                    { text: "Lancip Samasisi", isCorrect: false },
                    { text: "Tumpul Sembarang", isCorrect: false },
                    { text: "Sikusiku Sembarang", isCorrect: false }
                ],
                explanation: "Karena ada sudut 90° (siku-siku) dan dua sudut yang sama 45° (membuktikan dua sisi sama panjang/sama kaki)."
            },
            {
                question: "10. Pak Guru meminta siswa mencari persamaan persegi dan belah ketupat. Jawaban paling tepat dan kritis yang harus diberikan siswa adalah...",
                options: [
                    { text: "Keempat Sisinya Sama", isCorrect: true },
                    { text: "Keempat Sudutnya Siku", isCorrect: false },
                    { text: "Diagonalnya Sama Panjang", isCorrect: false },
                    { text: "Simetri Lipatnya Empat", isCorrect: false }
                ],
                explanation: "Baik persegi maupun belah ketupat sama-sama memiliki ciri khas: keempat sisinya sama panjang."
            },
            {
                question: "11. Sebuah segiempat memiliki diagonal yang berpotongan tidak tegak lurus, namun saling membagi dua sama panjang. Bangun apakah itu?",
                options: [
                    { text: "Jajargenjang", isCorrect: true },
                    { text: "Persegi", isCorrect: false },
                    { text: "Belahketupat", isCorrect: false },
                    { text: "Layanglayang", isCorrect: false }
                ],
                explanation: "Pada jajar genjang, diagonal membagi dua sama panjang, tetapi berpotongan tidak tegak lurus."
            },
            {
                question: "12. Jumlah total sudut dalam pada semua jenis segiempat selalu sama. Jika satu sudut dikurangi, totalnya menjadi...",
                options: [
                    { text: "Tiga Ratus Enampuluh", isCorrect: false },
                    { text: "Dua Ratus Tujuhpuluh", isCorrect: true }, // Asumsi rata-rata sudut 90 (hanya ilustrasi hitungan kata) - soal HOTS analitis. Ralat: Jumlah sudut segiempat 360. Jika dikurangi 90 menjadi 270.
                    { text: "Seratus Delapan Puluh", isCorrect: false },
                    { text: "Empat Ratus Limapuluh", isCorrect: false }
                ],
                explanation: "Jumlah sudut segiempat adalah 360°. Jika kita mengasumsikan persegi panjang, satu sudut 90°, dikurangi menjadi 270°. (Pertanyaan logika analitis)."
            },
            {
                question: "13. Di antara bangun datar berikut, manakah yang tidak mungkin memiliki sudut tumpul?",
                options: [
                    { text: "Persegi", isCorrect: true },
                    { text: "Jajargenjang", isCorrect: false },
                    { text: "Trapesium", isCorrect: false },
                    { text: "Belahketupat", isCorrect: false }
                ],
                explanation: "Persegi (termasuk persegi panjang) seluruh sudutnya pasti bersudut 90° (siku-siku), tidak mungkin tumpul (>90°)."
            },
            {
                question: "14. Sebuah segitiga memiliki panjang sisi 5cm, 7cm, dan 10cm. Jika dikaitkan dengan ciri sudutnya, kemungkinan terbesarnya adalah...",
                options: [
                    { text: "Segitiga Tumpul", isCorrect: true },
                    { text: "Segitiga Lancip", isCorrect: false },
                    { text: "Segitiga Sikusiku", isCorrect: false },
                    { text: "Segitiga Samakaki", isCorrect: false }
                ],
                explanation: "Menurut aturan pythagoras, jika c² > a² + b² (100 > 25 + 49 -> 100 > 74), maka segitiga tersebut adalah segitiga tumpul."
            },
            {
                question: "15. Bangun segiempat yang memiliki dua sumbu simetri lipat dan putar adalah...",
                options: [
                    { text: "Persegi Panjang", isCorrect: true },
                    { text: "Trapesium Sama", isCorrect: false },
                    { text: "Jajar Genjang", isCorrect: false },
                    { text: "Layang Layang", isCorrect: false }
                ],
                explanation: "Persegi panjang memiliki dua sumbu simetri lipat (horizontal dan vertikal) dan simetri putar tingkat dua."
            },
            {
                question: "16. Sebuah bangun hanya bisa menempati bingkainya dengan dua cara. Bangun tersebut pasti bukan...",
                options: [
                    { text: "Persegi", isCorrect: true },
                    { text: "PersegiPanjang", isCorrect: false },
                    { text: "BelahKetupat", isCorrect: false },
                    { text: "JajarGenjang", isCorrect: false }
                ],
                explanation: "Persegi dapat menempati bingkainya dengan 8 cara (4 putaran, 4 balikan/lipatan). Persegi panjang hanya 4 cara."
            },
            {
                question: "17. Dina menggambar dua diagonal pada sebuah kertas. Kedua diagonal tersebut sama panjang dan berpotongan tegak lurus. Kertas Dina berbentuk...",
                options: [
                    { text: "Persegi", isCorrect: true },
                    { text: "Persegipanjang", isCorrect: false },
                    { text: "Belahketupat", isCorrect: false },
                    { text: "Layanglayang", isCorrect: false }
                ],
                explanation: "Sifat diagonal yang berpotongan tegak lurus dan panjangnya sama secara bersamaan hanya dimiliki oleh bangun Persegi."
            },
            {
                question: "18. Mengapa jajar genjang tidak memiliki simetri lipat sama sekali?",
                options: [
                    { text: "Sisinya Miring", isCorrect: true },
                    { text: "Sudutnya Siku", isCorrect: false },
                    { text: "Diagonalnya Sama", isCorrect: false },
                    { text: "Sisinya Lengkung", isCorrect: false }
                ],
                explanation: "Jajar genjang tidak memiliki simetri lipat karena kemiringan sisinya membuat sudut yang berhadapan tidak bisa saling menutupi jika dilipat pada titik tengah."
            },
            {
                question: "19. Apakah trapesium sembarang bisa dibagi menjadi dua bangun segitiga? Jika ditarik...",
                options: [
                    { text: "Satu Diagonal", isCorrect: true },
                    { text: "Dua Diagonal", isCorrect: false },
                    { text: "Garis Tengah", isCorrect: false },
                    { text: "Sumbu Simetri", isCorrect: false }
                ],
                explanation: "Setiap segiempat, termasuk trapesium sembarang, jika ditarik tepat satu garis diagonal akan terbagi menjadi dua buah segitiga."
            },
            {
                question: "20. Jika panjang sisi miring sebuah layang-layang semuanya dibuat sama panjang, maka layang-layang tersebut akan berubah wujud menjadi...",
                options: [
                    { text: "Belah Ketupat", isCorrect: true },
                    { text: "Persegi Panjang", isCorrect: false },
                    { text: "Jajar Genjang", isCorrect: false },
                    { text: "Segitiga Sama", isCorrect: false }
                ],
                explanation: "Layang-layang memiliki dua pasang sisi yang sama panjang. Jika keempat sisinya dibuat sama, bangun tersebut menjadi belah ketupat."
            },
            {
                question: "21. Dari kelompok bangun datar di bawah ini, mana yang sepasang sudutnya tidak pernah 180° jika dijumlahkan (sudut berdekatan)?",
                options: [
                    { text: "Segitiga", isCorrect: true },
                    { text: "Persegi", isCorrect: false },
                    { text: "Jajargenjang", isCorrect: false },
                    { text: "Belahketupat", isCorrect: false }
                ],
                explanation: "Pada segiempat sejajar (persegi, jajargenjang), sudut yang berdekatan jumlahnya pasti 180°. Pada segitiga tidak ada aturan demikian (total semuanya baru 180°)."
            },
            {
                question: "22. Dalam jajar genjang, sudut A besarnya 60°. Maka besar sudut C yang berhadapan persis dengan sudut A adalah...",
                options: [
                    { text: "Enampuluh Derajat", isCorrect: true },
                    { text: "Seratusduapuluh Derajat", isCorrect: false },
                    { text: "Sembilanpuluh Derajat", isCorrect: false },
                    { text: "Seratusdelapanpuluh Derajat", isCorrect: false }
                ],
                explanation: "Pada jajar genjang, sudut yang saling berhadapan selalu sama besar. Jadi sudut C juga 60°."
            },
            {
                question: "23. Trapesium siku-siku memiliki ciri unik dibanding trapesium lainnya, yaitu mempunyai tepat dua sudut...",
                options: [
                    { text: "Siku Siku", isCorrect: true },
                    { text: "Lancip Tumpul", isCorrect: false },
                    { text: "Sama Besar", isCorrect: false },
                    { text: "Saling Berhadapan", isCorrect: false }
                ],
                explanation: "Trapesium siku-siku memiliki tepat 2 sudut siku-siku (90°) pada salah satu sisi tegaknya."
            },
            {
                question: "24. Ciri yang membedakan segitiga sama kaki dan segitiga sembarang terletak pada...",
                options: [
                    { text: "Panjang Sisinya", isCorrect: true },
                    { text: "Jumlah Sudutnya", isCorrect: false },
                    { text: "Titik Puncaknya", isCorrect: false },
                    { text: "Garis Lurusnya", isCorrect: false }
                ],
                explanation: "Segitiga sama kaki memiliki 2 sisi yang sama panjang, sedangkan segitiga sembarang ketiga sisinya berbeda panjang semua."
            },
            {
                question: "25. Jika dua buah segitiga siku-siku sembarang disatukan pada salah satu sisi siku-sikunya, bangun segiempat apa yang mungkin tidak terbentuk?",
                options: [
                    { text: "Persegi Panjang", isCorrect: true },
                    { text: "Layang Layang", isCorrect: false },
                    { text: "Segitiga Baru", isCorrect: false }, // Mengelabui
                    { text: "Segiempat Sembarang", isCorrect: false }
                ],
                explanation: "Persegi panjang tidak akan terbentuk jika dua segitiga siku-sikunya sembarang (panjang kakinya beda) dan disatukan pada sisi yang tidak identik panjangnya."
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let userName = "";
        let userClass = "";
        let shuffledQuestions = [];
        let userState = []; 
        let pointsPerQuestion = 100 / bankSoal.length;

        // Shuffle Function (Fisher-Yates)
        function shuffleArray(array) {
            let newArr = [...array];
            for (let i = newArr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
            }
            return newArr;
        }

        // Initialize App
        function init() {
            loadHistory();
        }

        function loadHistory() {
            const historyBody = document.getElementById('historyBody');
            historyBody.innerHTML = '';
            let history = JSON.parse(localStorage.getItem(storageKey)) || [];
            
            if (history.length === 0) {
                historyBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Belum ada riwayat skor.</td></tr>';
            } else {
                history.forEach(item => {
                    historyBody.innerHTML += `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.kelas}</td>
                            <td>${item.score}</td>
                            <td>${item.time}</td>
                        </tr>
                    `;
                });
            }
        }

        function startQuiz() {
            userName = document.getElementById('namaLengkap').value.trim();
            userClass = document.getElementById('kelas').value.trim();

            if (!userName || !userClass) {
                alert("Harap isi Nama Lengkap dan Kelas terlebih dahulu!");
                return;
            }

            // Setup Quiz
            score = 0;
            currentQuestionIndex = 0;
            userState = new Array(bankSoal.length).fill(null);
            
            // Acak Soal
            shuffledQuestions = shuffleArray(bankSoal).map(q => {
                // Acak juga Opsi Jawaban di dalamnya
                return {
                    ...q,
                    options: shuffleArray(q.options)
                };
            });

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';

            renderQuestion();
        }

        function renderQuestion() {
            const q = shuffledQuestions[currentQuestionIndex];
            
            // Update Header
            document.getElementById('q-current').textContent = currentQuestionIndex + 1;
            document.getElementById('current-score').textContent = Math.round(score);

            // Render Text
            document.getElementById('question-text').textContent = q.question;

            // Render Image (if exists)
            const imgContainer = document.getElementById('question-image-container');
            if (q.image) {
                // Berikan keterangan/alt tag agar mudah diedit offline
                imgContainer.innerHTML = `<img src="${q.image}" alt="${q.imageAlt}">`;
                imgContainer.style.display = 'block';
            } else {
                imgContainer.style.display = 'none';
            }

            // Render Options
            const optsContainer = document.getElementById('options-container');
            optsContainer.innerHTML = '';
            
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn option-btn';
                btn.textContent = `${String.fromCharCode(65 + index)}. ${opt.text}`; // A. B. C. D.
                
                // Cek apakah soal ini sudah dijawab
                if (userState[currentQuestionIndex]) {
                    btn.disabled = true;
                    if (opt.isCorrect) btn.classList.add('correct');
                    if (userState[currentQuestionIndex].selectedIndex === index && !opt.isCorrect) {
                        btn.classList.add('wrong');
                    }
                } else {
                    btn.onclick = () => selectOption(index, opt.isCorrect);
                }
                optsContainer.appendChild(btn);
            });

            // Toggle Explanation
            const explanationDiv = document.getElementById('explanation');
            if (userState[currentQuestionIndex]) {
                document.getElementById('explanation-text').textContent = q.explanation;
                explanationDiv.style.display = 'block';
            } else {
                explanationDiv.style.display = 'none';
            }

            // Toggle Nav Buttons
            document.getElementById('btn-prev').style.visibility = currentQuestionIndex === 0 ? 'hidden' : 'visible';
            document.getElementById('btn-next').textContent = currentQuestionIndex === bankSoal.length - 1 ? 'Selesaikan Kuis' : 'Soal Selanjutnya';
        }

        function selectOption(index, isCorrect) {
            userState[currentQuestionIndex] = { selectedIndex: index, isCorrect: isCorrect };
            
            if (isCorrect) {
                score += pointsPerQuestion;
            }
            
            renderQuestion(); // Re-render to show colors, explanation, and update score
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function nextQuestion() {
            if (!userState[currentQuestionIndex]) {
                alert("Silakan pilih jawaban terlebih dahulu sebelum lanjut!");
                return;
            }

            if (currentQuestionIndex < bankSoal.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            // Save History
            const finalScore = Math.round(score);
            let history = JSON.parse(localStorage.getItem(storageKey)) || [];
            
            const now = new Date();
            const timeStr = now.toLocaleDateString('id-ID') + ' ' + now.toLocaleTimeString('id-ID');

            history.push({
                name: userName,
                kelas: userClass,
                score: finalScore,
                time: timeStr
            });
            localStorage.setItem(storageKey, JSON.stringify(history));

            // Show Result
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-score').textContent = finalScore;
        }

        // Run Init
        window.onload = init;
    </script>
</body>
</html>