<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Matematika Kelas 1 - Kurikulum Merdeka</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        :root {
            --primary: #FF9F1C;
            --secondary: #2EC4B6;
            --background: #EAF4F4;
            --text: #011627;
            --correct: #4CAF50;
            --wrong: #F44336;
            --white: #FFFFFF;
        }

        * {
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
        }

        body {
            background-color: var(--background);
            background-image: radial-gradient(#2EC4B6 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .app-container {
            background-color: var(--white);
            width: 100%;
            max-width: 600px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header-code {
            background-color: var(--text);
            color: var(--white);
            text-align: center;
            padding: 5px;
            font-size: 12px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .screen {
            display: none;
            padding: 30px;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        h1, h2, h3 {
            text-align: center;
            color: var(--text);
            margin-top: 0;
        }

        .title-deco {
            color: var(--primary);
            font-size: 28px;
            text-shadow: 2px 2px 0px #FFE5D9;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            color: var(--secondary);
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #CBF3F0;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--secondary);
        }

        .btn {
            background-color: var(--primary);
            color: var(--white);
            border: none;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 5px 0 #D97A00;
            transition: 0.2s;
            width: 100%;
            text-align: center;
            margin-top: 10px;
        }

        .btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        .btn-nav-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-nav {
            background-color: var(--secondary);
            box-shadow: 0 5px 0 #1B998B;
            flex: 1;
        }

        .btn-nav:disabled {
            background-color: #A0A0A0;
            box-shadow: 0 5px 0 #808080;
            cursor: not-allowed;
            transform: none;
        }

        .history-container {
            margin-top: 30px;
            background: #F8F9FA;
            padding: 15px;
            border-radius: 15px;
            border: 2px dashed #CBF3F0;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .history-table th, .history-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .quiz-info {
            display: flex;
            justify-content: space-between;
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-btn {
            background-color: white;
            border: 3px solid #CBF3F0;
            padding: 15px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-align: left;
            transition: 0.3s;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #EAF4F4;
            border-color: var(--secondary);
        }

        .option-btn.correct {
            background-color: var(--correct);
            color: white;
            border-color: var(--correct);
        }

        .option-btn.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: var(--wrong);
        }

        .option-btn:disabled {
            cursor: not-allowed;
        }

        .explanation {
            margin-top: 20px;
            background-color: #FFF3E0;
            border-left: 5px solid var(--primary);
            padding: 15px;
            border-radius: 5px 10px 10px 5px;
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        footer {
            background-color: var(--text);
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 12px;
            line-height: 1.6;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: bold;
        }

    </style>
</head>
<body>

<div class="app-container">
    <div class="header-code">Kode: MTK-K1-S2-B6-HOTS</div>

    <div id="login-screen" class="screen active">
        <h1 class="title-deco">‚ú® Kuis Matematika Seru! ‚ú®</h1>
        <p style="text-align: center; font-weight: bold;">Bab: Penjumlahan & Pengurangan sampai 20</p>
        
        <div class="form-group">
            <label for="student-name">Nama Lengkap:</label>
            <input type="text" id="student-name" placeholder="Tulis namamu di sini..." required>
        </div>
        
        <div class="form-group">
            <label for="student-class">Kelas:</label>
            <input type="text" id="student-class" placeholder="Contoh: 1A" required>
        </div>
        
        <button class="btn" onclick="startQuiz()">üöÄ Mulai Kuis</button>
        
        <button class="btn" style="background-color: var(--secondary); box-shadow: 0 5px 0 #1B998B;" onclick="window.location.href='../index.html'">üè† Kembali ke Menu Utama</button>

        <div class="history-container">
            <h3>üèÜ Papan Skor Pencapaian</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Nama</th>
                        <th>Kelas</th>
                        <th>Skor</th>
                        <th>Waktu</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                </tbody>
            </table>
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <div class="quiz-info">
            <span id="question-number">Soal: 1/25</span>
            <span id="current-score">Skor: 0</span>
        </div>
        
        <div class="question-text" id="question-text">Memuat pertanyaan...</div>
        
        <div class="options-container" id="options-container">
        </div>

        <div class="explanation" id="explanation">
            <strong>üí° Pembahasan:</strong> <span id="explanation-text"></span>
        </div>

        <div class="btn-nav-container">
            <button class="btn btn-nav" id="btn-prev" onclick="prevQuestion()">‚¨ÖÔ∏è Sebelumnya</button>
            <button class="btn btn-nav" id="btn-next" onclick="nextQuestion()">Selanjutnya ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h1 class="title-deco">üéâ Kuis Selesai! üéâ</h1>
        <h2 id="final-name" style="color: var(--secondary);">Nama</h2>
        <h1 style="font-size: 60px; color: var(--primary); margin: 10px 0;" id="final-score">100</h1>
        <p style="text-align: center; font-size: 18px;">Luar biasa! Kamu sudah belajar dengan sangat baik hari ini.</p>
        <button class="btn" onclick="goToHome()">üè† Kembali ke Awal</button>
    </div>

    <footer>
        <span id="year"></span> Oleh : Dwi Endrasto - hak cipta dilindungi.<br>
        Produk ini asli jika didapatkan/dibeli melalui <a href="https://lynk.id/smartbanksoal" target="_blank">https://lynk.id/smartbanksoal</a>
    </footer>
</div>

<script>
    // KUNCI PENYIMPANAN UNIK UNTUK MENCEGAH BENTROKAN SKOR ANTAR KUIS
    const STORAGE_KEY = 'history_MTK_K1_S2_B6_HOTS';

    // Set Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Bank Soal
    const questionsDB = [
        { q: "Budi punya 15 kelereng. Ali punya 12 kelereng. Siapa yang kelerengnya lebih banyak dan berapa selisihnya?", correct: "Budi, selisih tiga", wrong: ["Ali, selisih tiga", "Budi, selisih lima"], exp: "15 lebih besar dari 12, jadi Budi lebih banyak. Selisihnya adalah 15 - 12 = 3 kelereng." },
        { q: "Siti memetik 8 mangga. Ayah memetik 9 mangga. Berapa jumlah mangga mereka jika digabungkan bersama?", correct: "Tujuh belas buah", wrong: ["Enam belas buah", "Lapan belas buah"], exp: "Mangga Siti ditambah mangga Ayah adalah 8 + 9 = 17 buah mangga." },
        { q: "Ibu membuat 18 kue. Adik memakan 5 kue. Berapa sisa kue yang belum dimakan oleh adik?", correct: "Tiga belas kue", wrong: ["Dua belas kue", "Lima belas kue"], exp: "Kue berkurang karena dimakan, maka 18 - 5 = 13 kue." },
        { q: "Kakak punya 14 buku cerita. Adik punya 17 buku cerita. Pernyataan mana yang paling tepat?", correct: "Buku kakak sedikit", wrong: ["Buku adik sedikit", "Buku mereka sama"], exp: "Angka 14 kurang dari 17. Jadi buku kakak lebih sedikit dari buku adik." },
        { q: "Di pohon ada 7 burung. Datang lagi burung sehingga jumlahnya 15. Berapa burung yang baru datang?", correct: "Delapan ekor burung", wrong: ["Tujuh ekor burung", "Sembilan ekor burung"], exp: "Burung awal 7, menjadi 15. Maka burung yang datang adalah 15 - 7 = 8 ekor." },
        { q: "Reno punya kotak isi 19 pensil. Ia membagikan beberapa pensil sehingga sisanya 11. Berapa yang dibagikan?", correct: "Delapan buah pensil", wrong: ["Tujuh buah pensil", "Sembilan buah pensil"], exp: "Pensil awal 19, sisa 11. Maka yang dibagikan adalah 19 - 11 = 8 pensil." },
        { q: "Umur kucing Ani 16 bulan. Umur kucing Edo 13 bulan. Berapa selisih umur kedua kucing tersebut?", correct: "Tiga bulan lamanya", wrong: ["Dua bulan lamanya", "Empat bulan lamanya"], exp: "Selisih dicari dengan mengurangi yang besar dengan yang kecil: 16 - 13 = 3 bulan." },
        { q: "Tina membeli 5 apel, 6 jeruk, dan 4 pir. Berapa total buah yang dibeli oleh Tina?", correct: "Lima belas buah", wrong: ["Enam belas buah", "Empat belas buah"], exp: "Jumlahkan semuanya: 5 + 6 = 11, lalu 11 + 4 = 15 buah." },
        { q: "Ada 20 penumpang di bus. Turun 6 orang, lalu turun lagi 3 orang. Berapa penumpang tersisa sekarang?", correct: "Sebelas orang penumpang", wrong: ["Sepuluh orang penumpang", "Dua belas penumpang"], exp: "Awalnya 20, turun 6 menjadi 14. Lalu turun 3 menjadi 14 - 3 = 11 penumpang." },
        { q: "Doni punya 15 stiker. Rina punya stiker lebih banyak dari Doni tetapi kurang dari 17. Berapa stikernya?", correct: "Enam belas stiker", wrong: ["Empat belas stiker", "Delapan belas stiker"], exp: "Angka yang lebih dari 15 tetapi kurang dari 17 adalah 16." },
        { q: "Buku gambar Rara halaman 10 sampai 18 sudah diwarnai. Berapa banyak halaman yang sudah diwarnai Rara?", correct: "Sembilan lembar halaman", wrong: ["Delapan lembar halaman", "Sepuluh lembar halaman"], exp: "Hitung halamannya: 10, 11, 12, 13, 14, 15, 16, 17, 18. Semuanya ada 9 halaman." },
        { q: "Pita merah panjangnya 19 cm. Pita biru panjangnya 12 cm. Berapa selisih panjang pita merah biru?", correct: "Tujuh sentimeter saja", wrong: ["Delapan sentimeter saja", "Enam sentimeter saja"], exp: "Selisih pita merah dan pita biru adalah 19 - 12 = 7 cm." },
        { q: "Sisa permen di toples adalah 8. Sebelumnya paman mengambil 7 permen. Berapa jumlah permen mula-mula?", correct: "Lima belas permen", wrong: ["Enam belas permen", "Empat belas permen"], exp: "Sisa ditambah yang diambil paman: 8 + 7 = 15 permen." },
        { q: "Di keranjang ada 15 telur. Beberapa telur pecah, sekarang telur yang utuh sisa 9. Berapa telur pecah?", correct: "Enam butir telur", wrong: ["Tujuh butir telur", "Lima butir telur"], exp: "Telur awal 15 dikurangi sisa 9, maka yang pecah adalah 15 - 9 = 6 butir." },
        { q: "Harga pensil 8 koin. Harga penghapus 7 koin. Adik punya 10 koin. Berapa koin tambahan yang dibutuhkan?", correct: "Lima koin lagi", wrong: ["Enam koin lagi", "Empat koin lagi"], exp: "Total harga: 8 + 7 = 15. Koin adik 10. Kekurangannya 15 - 10 = 5 koin." },
        { q: "Jarak rumah Tono 14 meter. Jarak rumah Andi 18 meter. Rumah siapa yang lebih dekat dengan sekolah?", correct: "Rumah si Tono", wrong: ["Rumah si Andi", "Jaraknya sama saja"], exp: "Angka 14 lebih kecil dari 18. Jadi jarak rumah Tono lebih dekat." },
        { q: "Dina melompat ke depan 8 langkah, lalu melompat lagi 6 langkah. Di angka berapa Dina berdiri?", correct: "Empat belas langkah", wrong: ["Lima belas langkah", "Tiga belas langkah"], exp: "Total lompatan Dina adalah 8 + 6 = 14 langkah." },
        { q: "Dari 19 balon yang ditiup, ada 12 balon warna merah dan sisanya biru. Berapa banyak balon biru?", correct: "Tujuh buah balon", wrong: ["Enam buah balon", "Delapan buah balon"], exp: "Total balon 19 dikurangi balon merah 12, maka balon biru 19 - 12 = 7 balon." },
        { q: "Kereta A membawa 17 penumpang. Kereta B membawa 14 penumpang. Berapa selisih penumpang di kedua kereta?", correct: "Tiga orang penumpang", wrong: ["Empat orang penumpang", "Dua orang penumpang"], exp: "Selisih penumpang dihitung dengan 17 - 14 = 3 penumpang." },
        { q: "Ayam bertelur 12 butir. Digoreng ibu 4 butir, lalu ayam bertelur lagi 5. Berapa sisa telur?", correct: "Tiga belas butir", wrong: ["Dua belas butir", "Empat belas butir"], exp: "Awal 12, digoreng sisa 8. Lalu bertelur 5 lagi, jadinya 8 + 5 = 13 butir." },
        { q: "Di taman ada 9 bunga mawar dan 8 bunga melati. Berapa total bunga yang ada di taman?", correct: "Tujuh belas bunga", wrong: ["Delapan belas bunga", "Enam belas bunga"], exp: "Mawar ditambah melati menjadi 9 + 8 = 17 bunga." },
        { q: "Ibu memotong semangka 16 potong. Keluarga makan 9 potong setelah makan malam. Berapa sisa semangka sekarang?", correct: "Tujuh potong semangka", wrong: ["Enam potong semangka", "Delapan potong semangka"], exp: "Sisa semangka adalah 16 - 9 = 7 potong." },
        { q: "Rani butuh 18 manik-manik. Ia baru punya 11 manik merah dan 2 biru. Berapa kekurangannya?", correct: "Lima butir manik", wrong: ["Enam butir manik", "Empat butir manik"], exp: "Manik Rani ada 11 + 2 = 13. Kekurangannya adalah 18 - 13 = 5 manik." },
        { q: "Ada 14 mobil parkir. Sebanyak 5 mobil berwarna hitam, sisanya putih. Berapa jumlah mobil yang putih?", correct: "Sembilan buah mobil", wrong: ["Delapan buah mobil", "Sepuluh buah mobil"], exp: "Jumlah mobil putih adalah total dikurangi hitam: 14 - 5 = 9 mobil." },
        { q: "Skor tim A adalah 15. Skor tim B kurang 3 poin dari tim A. Berapa skor B?", correct: "Dua belas poin", wrong: ["Tiga belas poin", "Sebelas poin"], exp: "Skor B kurang 3 dari A, artinya 15 - 3 = 12 poin." }
    ];

    let currentSessionQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let studentName = "";
    let studentClass = "";
    let userAnswers = [];

    // Fisher-Yates Shuffle Function
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    function initHistory() {
        // Menggunakan STORAGE_KEY yang spesifik untuk kuis ini
        const history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        const tbody = document.getElementById('history-body');
        tbody.innerHTML = '';
        
        if(history.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Belum ada history. Jadilah yang pertama!</td></tr>';
            return;
        }

        // Urutkan dari yang terbaru
        history.reverse().forEach(entry => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${entry.name}</td>
                <td>${entry.kelas}</td>
                <td><strong>${entry.score}</strong>/100</td>
                <td>${entry.time}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    function startQuiz() {
        const nameInput = document.getElementById('student-name').value.trim();
        const classInput = document.getElementById('student-class').value.trim();

        if (!nameInput || !classInput) {
            alert('Tolong isi Nama dan Kelasmu dulu ya!');
            return;
        }

        studentName = nameInput;
        studentClass = classInput;
        score = 0;
        currentQuestionIndex = 0;
        userAnswers = [];

        // Siapkan soal untuk sesi ini (pilihan diacak sekali di awal)
        currentSessionQuestions = questionsDB.map(q => {
            let options = [
                { text: q.correct, isCorrect: true },
                { text: q.wrong[0], isCorrect: false },
                { text: q.wrong[1], isCorrect: false }
            ];
            return {
                ...q,
                shuffledOptions: shuffle(options)
            };
        });
        document.getElementById('login-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');

        loadQuestion();
    }

    function loadQuestion() {
        const qData = currentSessionQuestions[currentQuestionIndex];
        document.getElementById('question-number').textContent = `Soal: ${currentQuestionIndex + 1}/${currentSessionQuestions.length}`;
        document.getElementById('current-score').textContent = `Skor: ${score}`;
        document.getElementById('question-text').textContent = qData.q;
        document.getElementById('explanation-text').textContent = qData.exp;
        
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        const explanationDiv = document.getElementById('explanation');
        
        // Cek apakah user sudah menjawab soal ini
        const hasAnswered = userAnswers[currentQuestionIndex] !== undefined;
        if (hasAnswered) {
            explanationDiv.style.display = 'block';
        } else {
            explanationDiv.style.display = 'none';
        }

        qData.shuffledOptions.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = `${String.fromCharCode(65 + index)}. ${opt.text}`;
            
            if (hasAnswered) {
                btn.disabled = true;
                const userAnswer = userAnswers[currentQuestionIndex];
                
                if (opt.isCorrect) {
                    btn.classList.add('correct');
                } else if (userAnswer.selectedText === opt.text && !opt.isCorrect) {
                    btn.classList.add('wrong');
                }
            } else {
                btn.onclick = () => selectAnswer(btn, opt);
            }

            optionsContainer.appendChild(btn);
        });

        // Logika tombol Next/Prev
        document.getElementById('btn-prev').disabled = currentQuestionIndex === 0;
        const btnNext = document.getElementById('btn-next');
        if (currentQuestionIndex === currentSessionQuestions.length - 1) {
            btnNext.textContent = "Selesai üèÅ";
            btnNext.onclick = finishQuiz;
        } else {
            btnNext.textContent = "Selanjutnya ‚û°Ô∏è";
            btnNext.onclick = nextQuestion;
        }
    }

    function selectAnswer(selectedBtn, optData) {
        const optionsDivs = document.getElementById('options-container').children;
        // Kunci semua tombol
        for (let btn of optionsDivs) {
            btn.disabled = true;
            // Highlight jawaban yang benar
            if (btn.textContent.substring(3) === currentSessionQuestions[currentQuestionIndex].correct) {
                btn.classList.add('correct');
            }
        }

        if (optData.isCorrect) {
            selectedBtn.classList.add('correct');
            score += 4; // 25 soal x 4 = 100
        } else {
            selectedBtn.classList.add('wrong');
        }

        document.getElementById('current-score').textContent = `Skor: ${score}`;
        document.getElementById('explanation').style.display = 'block';
        // Simpan jawaban agar tidak bisa diubah jika ditekan 'Soal Sebelumnya'
        userAnswers[currentQuestionIndex] = {
            selectedText: optData.text,
            isCorrect: optData.isCorrect
        };
    }

    function nextQuestion() {
        if (!userAnswers[currentQuestionIndex]) {
            alert("Pilih jawabanmu dulu ya!");
            return;
        }
        currentQuestionIndex++;
        loadQuestion();
    }

    function prevQuestion() {
        currentQuestionIndex--;
        loadQuestion();
    }

    function finishQuiz() {
        if (!userAnswers[currentQuestionIndex]) {
            alert("Pilih jawabanmu dulu ya sebelum selesai!");
            return;
        }

        // Simpan ke local storage menggunakan STORAGE_KEY spesifik
        const history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        const now = new Date();
        const timeString = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}`;
        history.push({
            name: studentName,
            kelas: studentClass,
            score: score,
            time: timeString
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(history));

        // Tampilkan layar hasil
        document.getElementById('quiz-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
        
        document.getElementById('final-name').textContent = `${studentName} (Kelas ${studentClass})`;
        document.getElementById('final-score').textContent = score;
    }

    function goToHome() {
        document.getElementById('result-screen').classList.remove('active');
        document.getElementById('login-screen').classList.add('active');
        document.getElementById('student-name').value = '';
        document.getElementById('student-class').value = '';
        initHistory(); // Refresh history
    }

    // Jalankan saat halaman pertama kali dibuka
    window.onload = initHistory;
</script>
</body>
</html>